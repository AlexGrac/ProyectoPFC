<!doctype html>
<html lang="en">
    <head>
        <title>Proyecto PFC</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body { margin: 0; overflow: hidden; }
        </style>
    </head>
    <body>

        <div id="webgl"></div>
        <script src="js/libs/three/three.min.js"></script>
        <script src="js/libs/three/ControlesMapa.js"></script> 
        <script src="js/libs/three/ControlesMapa2.js"></script> 
        <script src="js/libs/other/TerrainLoader.js"></script> 
        <script src="js/libs/other/OBJExporter.js"></script>



        <script>
            var mun = [];
            var width = window.innerWidth,
                    height = window.innerHeight;

            var scene = new THREE.Scene();

            var camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            camera.position.set(0, 10, 5);
            camera.lookAt(scene.position);

            var renderer = new THREE.WebGLRenderer();
            renderer.setSize(width, height);
            var terrainLoader = new THREE.TerrainLoader();
            terrainLoader.load('data/DEMEspana2.bin', function(data) {

                //var geometry = new THREE.PlaneGeometry(144, 103, 520, 372);//GDEMJaen
                //var geometry = new THREE.PlaneGeometry(60, 60, 199, 199);//JaenDEM
                var geometry = new THREE.PlaneGeometry(133, 76, 591, 365);//GDEMEspana
                //var geometry = new THREE.PlaneGeometry(116, 96, 393, 243);//GDEMEspana30
                for (var i = 0; i < geometry.vertices.length; i++) {
                    geometry.vertices[i].z = data[i] / 65535 * 1.5;
                }

                var material1 = new THREE.MeshPhongMaterial({
                    map: THREE.ImageUtils.loadTexture('data/JaenTexturaSintetica30.jpg')
                });

                var material2 = new THREE.MeshPhongMaterial({
                    map: THREE.ImageUtils.loadTexture('data/espanaWGS84.jpg')
                });

                var material = new THREE.MeshPhongMaterial({
                    color: 0xdddddd,
                    wireframe: true
                });

                var material3 = new THREE.MeshLambertMaterial({
                    color: 0xaaaaaa
                });

                var plane = new THREE.Mesh(geometry, material2);
                plane.position.x = 66;
                plane.position.z = 38;
                plane.position.y = -0.5;
                plane.rotation.x = -Math.PI / 2;

                scene.add(plane);

            });


            var materialEsfera = new THREE.MeshLambertMaterial({color: 0xff0000});

            var geometriaEsfera = new THREE.SphereGeometry(50, 32, 16);


            var centro = new THREE.Mesh(geometriaEsfera, materialEsfera);
            centro.scale.set(0.01, 0.01, 0.01);
            centro.position.x = 42.93;
            centro.position.z = 61.82;
            scene.add(centro);


            scene.add(new THREE.AmbientLight(0xffffff));
            var light = new THREE.PointLight(0xffffff);
            //light.position.set(100, 250, 100);
            scene.add(light);
            //var controls = new THREE.TrackballControls(camera);
            var controls = new ControlesMapa2(camera, scene.position);




            document.getElementById('webgl').appendChild(renderer.domElement);

            render();

            function render() {
                controls.actualiza();     

 /*               for (var i = 0; i < mun.length; ++i) {
                    var punto = new THREE.Mesh(geometriaEsfera, materialEsfera);
                    punto.scale.set(0.01, 0.01, 0.01);
                    punto.position.x = mun[i].longitud * 133;
                    punto.position.z = mun[i].latitud * 76;
                    punto.name = "punto"+i;
                    scene.add(punto);
                }*/
                requestAnimationFrame(render);
                renderer.render(scene, camera);
            }




        </script>

    </body>
</html>